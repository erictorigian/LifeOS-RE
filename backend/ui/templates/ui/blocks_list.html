{% extends "ui/base.html" %}
{% block title %}Blocks - LifeOS{% endblock %}

{% block content %}
<!-- Header -->
<div style="margin-bottom: 40px;">
    <h2 style="margin: 0 0 8px 0; font-size: 28px; font-weight: bold; color: #f1f5f9;">Blocks</h2>
    <p style="margin: 0; font-size: 14px; color: #94a3b8;">Your immutable reality snapshots</p>
</div>

<!-- Blocks Timeline -->
<div id="blocks-list" style="max-width: 800px;"></div>

<style>
    .block-item {
        background-color: #1e293b;
        border: 1px solid #334155;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 16px;
        transition: all 0.2s;
    }
    .block-item:hover {
        border-color: #f59e0b;
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.1);
    }
    .block-timestamp {
        font-size: 12px;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 12px;
    }
    .block-hash {
        font-family: 'Courier New', monospace;
        font-size: 11px;
        color: #64748b;
        background-color: rgba(0, 0, 0, 0.3);
        padding: 8px 12px;
        border-radius: 4px;
        margin-top: 12px;
        word-break: break-all;
        border-left: 3px solid #f59e0b;
    }
    .block-content {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        padding: 16px;
        margin-top: 16px;
        border-left: 3px solid #64748b;
        font-size: 14px;
        color: #cbd5e1;
        line-height: 1.6;
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    .block-metadata {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 12px;
        font-size: 13px;
    }
    .block-meta-item {
        display: flex;
        flex-direction: column;
    }
    .block-meta-label {
        font-size: 11px;
        color: #94a3b8;
        text-transform: uppercase;
        margin-bottom: 4px;
    }
    .block-meta-value {
        color: #f1f5f9;
        font-weight: 500;
    }
</style>

<script>
async function loadBlocks() {
    try {
        const response = await fetch("/api/blocks/");
        const blocks = await response.json();

        const container = document.getElementById("blocks-list");

        if (!blocks || blocks.length === 0) {
            container.innerHTML = `
                <div style="padding: 40px; text-align: center; color: #94a3b8; background-color: #1e293b; border-radius: 8px; border: 1px solid #334155;">
                    <p style="margin: 0; font-size: 16px;">No blocks yet. Your reality awaits.</p>
                </div>
            `;
            return;
        }

        blocks.forEach(b => {
            const date = new Date(b.created_at);
            const formattedDate = date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const blockDiv = document.createElement("div");
            blockDiv.className = "block-item";
            
            let contentHtml = '';
            if (typeof b.content === 'object') {
                contentHtml = `<pre class="block-content">${JSON.stringify(b.content, null, 2)}</pre>`;
            } else {
                contentHtml = `<div class="block-content">${b.content}</div>`;
            }

            blockDiv.innerHTML = `
                <div class="block-timestamp">Block #${b.id} • ${formattedDate}</div>
                ${contentHtml}
                ${b.hash ? `<div class="block-hash" title="Block hash">Hash: ${b.hash.substring(0, 32)}...</div>` : ''}
                <div class="block-metadata">
                    <div class="block-meta-item">
                        <span class="block-meta-label">Status</span>
                        <span class="block-meta-value">Immutable ✓</span>
                    </div>
                    <div class="block-meta-item">
                        <span class="block-meta-label">User</span>
                        <span class="block-meta-value">${b.user_id.substring(0, 8)}...</span>
                    </div>
                </div>
            `;
            
            container.appendChild(blockDiv);
        });
    } catch (error) {
        console.error('Error loading blocks:', error);
        document.getElementById("blocks-list").innerHTML = `
            <div style="padding: 40px; text-align: center; color: #ef4444; background-color: #1e293b; border-radius: 8px; border: 1px solid #334155;">
                <p style="margin: 0;">Error loading blocks. Please try again.</p>
            </div>
        `;
    }
}

loadBlocks();
</script>

{% endblock %}

